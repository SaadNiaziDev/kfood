---
import SectionHeading from "../ui/SectionHeading.astro";
import ProductCard from "../cards/ProductCard.astro";
import { ButterIcon, FlourIcon, MilkIcon, YogurtIcon, GheeIcon } from "../../assets/icons";
import BajraIcon from "../../assets/bajray.png";
import BesanIcon from "../../assets/besan.png";
import MakaiIcon from "../../assets/makai.png";
import OatFlourIcon from "../../assets/oat_flour.png";
import { Image } from "astro:assets";
import Button from "../ui/Button.astro";
import { Swiper, SwiperWrapper, SwiperSlide, SwiperButtonPrev, SwiperButtonNext } from "astro-swiper";
import { ChevronLeftIcon, ChevronRightIcon } from "@lucide/astro";

const categories = [
	{ icon: ButterIcon, label: "Butter" },
	{ icon: FlourIcon, label: "Flour" },
	{ icon: MilkIcon, label: "Milk" },
	{ icon: YogurtIcon, label: "Yogurt" },
	{ icon: GheeIcon, label: "Ghee" },
];
const products = [
	{ name: "Bajray Ka Atta", icon: BajraIcon, weight: "5kg" },
	{ name: "Besan", icon: BesanIcon, weight: "10kg" },
	{ name: "Makkai ka Atta", icon: MakaiIcon, weight: "2kg" },
	{ name: "Oat Flour", icon: OatFlourIcon, weight: "1kg" },
];
const productsForSwiper = [...products, ...products];
---

<section id='products' class='py-12 md:py-16 bg-white'>
	<div class='px-6 md:px-10 lg:px-16 flex flex-col items-center'>
		<SectionHeading title='Products' subtitle='Pure organic products for everyday life' />

		<div class='category-buttons flex flex-wrap justify-center gap-4 md:gap-8 lg:gap-10 mb-12'>
			{
				categories.map((category, index) => (
					<button
						type='button'
						class='category-btn flex flex-col items-center space-y-2 py-2 px-3 rounded-lg transition-all duration-200 cursor-pointer focus:outline-none focus-visible:ring-2 focus-visible:ring-kfood-primary focus-visible:ring-offset-2 hover:-translate-y-1 hover:text-kfood-primary active:scale-95'
						aria-pressed={index === 0 ? "true" : "false"}>
						<span class='category-btn-icon'>
							<Image src={category.icon} alt={category.label} class='w-12 h-12 md:w-16 md:h-16' />
						</span>
						<span class='text-xs md:text-sm font-medium text-muted category-btn-label'>{category.label}</span>
					</button>
				))
			}
		</div>

		<div class='products-swiper-wrap w-full mx-auto mb-8'>
			<Swiper
				uniqueClass='products-swiper'
				useCustomElement={false}
				addDefaultClass={false}
				options={{
					slidesPerView: 4,
					slidesPerGroup: 1,
					spaceBetween: 24,
					loop: true,
					navigation: {
						nextEl: ".products-swiper .swiper-button-next",
						prevEl: ".products-swiper .swiper-button-prev",
					},
					autoplay: { delay: 4000, disableOnInteraction: false },
					breakpoints: {
						320: { slidesPerView: 1, slidesPerGroup: 1 },
						640: { slidesPerView: 2, slidesPerGroup: 1 },
						768: { slidesPerView: 3, slidesPerGroup: 1 },
						1024: { slidesPerView: 4, slidesPerGroup: 1 },
					},
				}}>
				<SwiperWrapper>
					{
						productsForSwiper.map((product) =>
							product ? (
								<SwiperSlide>
									<ProductCard name={product.name} weight={product.weight} image={product.icon} />
								</SwiperSlide>
							) : null,
						)
					}
				</SwiperWrapper>
				<SwiperButtonPrev addDefaultClass={true} class='!text-black'>
					<ChevronLeftIcon class='w-6 h-6' />
				</SwiperButtonPrev>
				<SwiperButtonNext addDefaultClass={true} class='!text-black'>
					<ChevronRightIcon class='w-6 h-6' />
				</SwiperButtonNext>
			</Swiper>
		</div>
	</div>

	<div class='flex flex-col items-center justify-center space-y-4 px-4'>
		<div class='text-center text-base md:text-lg font-normal mt-4 tracking-wide md:tracking-widest font-body max-w-2xl'>
			Discover a curated selection of KFood products available to shop online.
		</div>
		<Button
			variant='primary'
			size='lg'
			class='btn-cta hover:!cursor-pointer !bg-accent-orange !text-white !border-none w-[350px] !text-xl md:text-2xl lg:text-[30px]'>
			Shop Now
		</Button>
	</div>
</section>

<style>
	.category-buttons .category-btn:hover .category-btn-icon img,
	.category-buttons .category-btn:focus-visible .category-btn-icon img,
	.category-buttons .category-btn:active .category-btn-icon img,
	.category-buttons .category-btn[aria-pressed="true"] .category-btn-icon img {
		filter: brightness(0) saturate(100%) invert(9%) sepia(42%) saturate(3500%) hue-rotate(195deg);
	}
	.category-buttons .category-btn:hover .category-btn-label,
	.category-buttons .category-btn:focus-visible .category-btn-label,
	.category-buttons .category-btn:active .category-btn-label,
	.category-buttons .category-btn[aria-pressed="true"] .category-btn-label {
		color: var(--color-kfood-primary);
	}
	.category-buttons .category-btn:hover,
	.category-buttons .category-btn:focus-visible {
		background-color: rgb(251 238 224 / 0.5);
	}
	.category-buttons .category-btn[aria-pressed="true"] {
		background-color: rgb(251 238 224 / 0.8);
		color: var(--color-kfood-primary);
	}

	.products-swiper-wrap :global(.products-swiper) {
		overflow: hidden;
		position: relative;
		width: 100%;
	}
	.products-swiper-wrap :global(.products-swiper .swiper-slide) {
		height: auto;
	}
	.products-swiper-wrap :global(.swiper-button-prev),
	.products-swiper-wrap :global(.swiper-button-next) {
		color: #8a8a8a;
		width: 36px;
		height: 36px;
		top: 50%;
		margin-top: -18px;
	}
	.products-swiper-wrap :global(.swiper-button-prev) {
		left: 0;
	}
	.products-swiper-wrap :global(.swiper-button-next) {
		right: 0;
	}
	.products-swiper-wrap :global(.swiper-button-prev::after),
	.products-swiper-wrap :global(.swiper-button-next::after) {
		font-size: 22px;
	}
	.products-swiper-wrap :global(.swiper-button-disabled) {
		opacity: 0.3;
	}
</style>

<script>
	document.querySelectorAll(".category-btn").forEach((btn) => {
		btn.addEventListener("click", () => {
			document.querySelectorAll(".category-btn").forEach((b) => b.setAttribute("aria-pressed", "false"));
			btn.setAttribute("aria-pressed", "true");
		});
	});
</script>
